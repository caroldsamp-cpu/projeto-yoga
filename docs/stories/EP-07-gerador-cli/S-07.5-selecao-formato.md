# Story 7.5: Selecao de Formato no CLI

**Epic:** EP-07 - Gerador de Roteiros CLI
**Story ID:** 7.5
**Prioridade:** :dart: Alta
**Pontos:** 5
**Esforco:** 4-5 horas
**Status:** :white_circle: Draft
**Tipo:** :computer: Desenvolvimento & Feature

---

## User Story

Como **criadora de conteudo do Mente Leve**, quero **selecionar o formato de saida (reel 30s, reel 60s, carrossel, story, post feed) ao gerar um roteiro no CLI**, para que **o conteudo ja venha estruturado para a plataforma e duracao que vou usar, sem precisar adaptar manualmente**.

## Objetivo

Adicionar ao CLI (apos Story 7.4) a selecao de formato de saida. Cada formato tem estrutura propria: reels tem duracao e marcacoes de tempo, carrossel tem slides, stories tem sequencia de telas, post feed tem texto corrido. O roteiro gerado ja vem no formato correto, pronto para gravar ou publicar.

## Contexto & Fundamentacao

- 5 formatos de conteudo mais usados pelo Mente Leve no Instagram
- Cada formato tem restricoes diferentes (duracao, numero de slides, caracteres)
- Reel 30s: rapido, 1 insight, hook nos primeiros 3s
- Reel 60s: completo, pode seguir Light Copy Pattern inteiro
- Carrossel: 5-10 slides, storytelling visual, CTA no ultimo
- Story: 3-5 telas, interativo, enquetes, perguntas
- Post feed: texto mais longo, reflexivo, caption de Instagram
- Estruturas de formato armazenadas em `prompts/formatos/`

## Scope

### Incluido
- Selecao interativa de formato no CLI (Inquirer list)
- 5 formatos com descricao e restricoes
- Arquivos .md de estrutura para cada formato
- Injecao da estrutura do formato no prompt
- Output formatado conforme o tipo escolhido
- Estimativa de duracao (reels) ou numero de slides (carrossel)

### Excluido
- Criacao de novos formatos
- Geracao de assets visuais (imagens, videos)
- Exportacao para plataformas (Buffer, Later, etc.)
- Testes automatizados (Story 7.6)

### Dependencias
- Story 7.3 (CLI Basico) -- base funcional
- Story 7.4 (Avatar) -- selecao de avatar ja implementada
- Story 7.1 (Arquitetura) -- estrutura de prompts/formatos/

### Entregaveis para downstream
- Story 7.6 (Testes) -- testar todos os formatos
- Equipe de conteudo -- roteiros prontos para uso

## Tasks Breakdown

### Fase 1: Criar Arquivos de Formato (~2h)
- [ ] Criar `prompts/formatos/reel-30.md`
  ```markdown
  # Formato: Reel 30 segundos

  ## Restricoes
  - Duracao: 25-35 segundos
  - Hook: primeiros 3 segundos (frase que para o scroll)
  - Maximo de 1 insight principal
  - Encerramento com CTA visual ou texto na tela

  ## Estrutura
  [0-3s] HOOK -- frase impactante, sensorial
  [3-10s] CONTEXTO -- expandir o hook, tocar a dor
  [10-20s] REFRAME -- a virada, o insight
  [20-28s] ENCERRAMENTO -- frase-ancora + convite
  [28-30s] CTA -- "siga para mais" ou texto na tela

  ## Estilo
  - Falar olhando para camera (ou voz off com imagens)
  - Ritmo: calmo mas sem pausas longas (30s e pouco)
  - Legendas obrigatorias
  - Musica suave de fundo (opcional)

  ## Exemplo de Marcacao
  [0-3s] "Voce parou hoje?"
  [3-10s] "Nao por cansaco. Por escolha."
  [10-20s] "5 minutos mudam como voce sente o dia inteiro."
  [20-28s] "Experimenta amanha. Antes do celular."
  [28-30s] [Texto na tela: @menteleve]
  ```
- [ ] Criar `prompts/formatos/reel-60.md`
  ```markdown
  # Formato: Reel 60 segundos

  ## Restricoes
  - Duracao: 50-65 segundos
  - Hook: primeiros 3 segundos
  - Pode seguir Light Copy Pattern completo (6 passos)
  - Encerramento emocional + CTA suave

  ## Estrutura (Light Copy Pattern adaptado)
  [0-3s] ABERTURA -- gancho sensorial
  [3-12s] DIAGNOSTICO -- espelhar a dor
  [12-25s] REFRAME -- virar a perspectiva
  [25-40s] VALIDACAO -- sem culpa, voce e ok
  [40-52s] CONVITE -- apresentar a solucao como opcao
  [52-60s] ENCERRAMENTO -- frase-ancora emocional

  ## Estilo
  - Tom de conversa intima (como audio pra amiga)
  - Pausas intencionais (criar respiro)
  - Pode alternar camera e voz off
  - Legendas obrigatorias
  ```
- [ ] Criar `prompts/formatos/carrossel.md`
  ```markdown
  # Formato: Carrossel Instagram

  ## Restricoes
  - 5 a 8 slides (ideal: 7)
  - Slide 1: capa com hook (para o scroll)
  - Ultimo slide: CTA + salvar/compartilhar
  - Maximo 30 palavras por slide
  - Storytelling progressivo (cada slide revela mais)

  ## Estrutura
  Slide 1: HOOK -- pergunta ou frase que para o scroll
  Slide 2: DIAGNOSTICO -- "voce ja sentiu isso?"
  Slide 3: APROFUNDAMENTO -- expandir a dor com empatia
  Slide 4: REFRAME -- a virada
  Slide 5: SOLUCAO -- o que Sadhana propoe
  Slide 6: PRATICA -- 1 receita ou exercicio simples
  Slide 7: CTA -- "salva pra lembrar" ou "manda pra alguem"

  ## Estilo
  - Texto grande, legivel (poucas palavras por slide)
  - Fundo clean (cores suaves)
  - Progressao emocional: dor -> acolhimento -> acao
  - Ultimo slide sempre com convite (nao imposicao)
  ```
- [ ] Criar `prompts/formatos/story.md`
  ```markdown
  # Formato: Story Instagram (Sequencia)

  ## Restricoes
  - 3 a 5 telas
  - Texto curto por tela (max 20 palavras)
  - Pode incluir stickers interativos (enquete, pergunta, emoji slider)
  - Tom mais casual e direto que feed

  ## Estrutura
  Tela 1: HOOK -- pergunta ou afirmacao curiosa
  Tela 2: CONTEXTO -- expandir (texto ou enquete)
  Tela 3: INSIGHT -- a virada ou pratica
  Tela 4: INTERACAO -- sticker (enquete: "voce tambem?", slider de emoji)
  Tela 5 (opcional): CTA -- "responde aqui" ou "link na bio"

  ## Elementos Interativos Sugeridos
  - Enquete: "Voce parou hoje? Sim / Ainda nao"
  - Emoji slider: "quanta leveza voce ta sentindo?"
  - Caixa de perguntas: "me conta: qual e seu momento de presenca?"
  - Quiz: "quantos minutos voce precisa pra sentir leveza?"

  ## Estilo
  - Tom de conversa rapida (nao reflexiva como feed)
  - Fundo colorido ou foto real
  - Texto sobre imagem (legivel)
  - Emojis permitidos (com moderacao)
  ```
- [ ] Criar `prompts/formatos/post-feed.md`
  ```markdown
  # Formato: Post Feed Instagram (Caption)

  ## Restricoes
  - Caption de 150 a 300 palavras
  - Primeira linha e o hook (aparece antes do "ver mais")
  - Paragrafos curtos (2-3 linhas)
  - Hashtags no final (max 10)
  - CTA suave no encerramento

  ## Estrutura (Light Copy Pattern)
  LINHA 1: Hook (primeira frase visivel, para o scroll)

  PARAGRAFO 1: Abertura sensorial (expandir o hook)

  PARAGRAFO 2: Diagnostico (tocar a dor com empatia)

  PARAGRAFO 3: Reframe (virar a perspectiva)

  PARAGRAFO 4: Validacao (sem culpa, permissao)

  PARAGRAFO 5: Convite (suave, com opcao)

  LINHA FINAL: Encerramento emocional

  HASHTAGS: #SadhanaReal #MenteLeve + 3-5 relacionadas

  ## Estilo
  - Quebras de linha generosas (respiro visual)
  - Tom reflexivo e poetico (mais que reel)
  - Como uma carta curta para uma amiga
  - Sem emojis em excesso (max 3)
  ```

### Fase 2: Atualizar CLI (~1h)
- [ ] Adicionar pergunta de selecao de formato
  ```javascript
  {
    type: 'list',
    name: 'formato',
    message: 'Qual o formato?',
    choices: [
      { name: 'Reel 30s (rapido, 1 insight, hook forte)', value: 'reel-30' },
      { name: 'Reel 60s (completo, Light Copy Pattern)', value: 'reel-60' },
      { name: 'Carrossel (5-8 slides, storytelling)', value: 'carrossel' },
      { name: 'Story (3-5 telas, interativo)', value: 'story' },
      { name: 'Post Feed (caption reflexivo, 150-300 palavras)', value: 'post-feed' }
    ]
  }
  ```
- [ ] Posicionar: tema -> avatar -> formato -> salvar?
- [ ] Exibir formato selecionado no output

### Fase 3: Atualizar Prompt Builder (~1h)
- [ ] Implementar leitura do arquivo de formato
  ```javascript
  export function buildPrompt(tema, avatar = 'geral', formato = 'post-feed') {
    // ... (codigo existente para system prompt e avatar)

    const formatoContext = readFileSync(
      join(__dirname, `../prompts/formatos/${formato}.md`),
      'utf-8'
    );

    // Injetar formato no user prompt
    const userPrompt = userPromptTemplate
      .replace('{{tema}}', tema)
      .replace('{{avatar_nome}}', getAvatarNome(avatar))
      .replace('{{formato}}', getFormatoNome(formato))
      .replace('{{formato_instrucoes}}', formatoContext);

    return { systemPrompt: fullSystemPrompt, userPrompt };
  }
  ```
- [ ] Criar funcao helper `getFormatoNome(formato)`
- [ ] Validar que arquivo de formato existe
- [ ] Tratar erro se formato invalido

### Fase 4: Atualizar Output (~0.5h)
- [ ] Adaptar formatacao do terminal por tipo
  - [ ] Reels: mostrar marcacoes de tempo [0-3s], [3-10s]...
  - [ ] Carrossel: mostrar "Slide 1:", "Slide 2:"...
  - [ ] Story: mostrar "Tela 1:", "Tela 2:"...
  - [ ] Post feed: mostrar texto corrido + hashtags
- [ ] Incluir estimativas no output
  - [ ] Reels: "Duracao estimada: ~30s" ou "~60s"
  - [ ] Carrossel: "Slides: 7"
  - [ ] Story: "Telas: 4"
  - [ ] Post: "Palavras: 187"

### Fase 5: Teste Manual (~0.5h)
- [ ] Gerar 1 roteiro para CADA formato com mesmo tema e avatar
  - [ ] Reel 30s: tem marcacoes de tempo? Cabe em 30s?
  - [ ] Reel 60s: segue Light Copy completo? Cabe em 60s?
  - [ ] Carrossel: tem 5-8 slides? Max 30 palavras/slide?
  - [ ] Story: tem 3-5 telas? Sugestoes de stickers?
  - [ ] Post feed: 150-300 palavras? Hook na primeira linha?
- [ ] Documentar resultados e ajustes necessarios

## Acceptance Criteria

### Must Have
- [ ] CLI oferece selecao de formato (5 opcoes)
- [ ] Descricao breve de cada formato visivel na selecao
- [ ] 5 arquivos .md de estrutura de formato criados
- [ ] Estrutura do formato injetada no prompt
- [ ] Roteiro respeita restricoes do formato (duracao, slides, palavras)
- [ ] Formato aparece na metadata do output

### Should Have
- [ ] Marcacoes de tempo para reels no output
- [ ] Numeracao de slides para carrossel no output
- [ ] Estimativas (duracao, slides, palavras) no output
- [ ] Teste comparativo documentado (mesmo tema, 5 formatos diferentes)

### Nice to Have
- [ ] Preview visual simplificado no terminal (box para cada slide)
- [ ] Validacao pos-geracao (aviso se excedeu restricoes)
- [ ] Sugestao de formato baseada no tema

## Entregaveis

| Entregavel | Localizacao | Conteudo | Usado Por |
|---|---|---|---|
| 5 Arquivos de Formato | `prompts/formatos/*.md` | Estruturas e restricoes | Prompt Builder |
| CLI atualizado | `sadhana-cli/src/` | Selecao de formato | Equipe |
| Teste comparativo | `docs/cli/teste-formatos.md` | 5 roteiros lado a lado | QA |

## Metricas de Sucesso

| Metrica | Meta | Como Medir |
|---|---|---|
| Roteiro respeita restricoes do formato | > 90% | Checklist manual |
| Reel 30s cabe em 30s (leitura em voz alta) | > 80% | Cronometro |
| Carrossel tem 5-8 slides com max 30 palavras | > 90% | Contagem |
| Post feed tem 150-300 palavras | > 90% | Contagem |
| Formatos sao visivelmente diferentes entre si | Sim | Comparacao visual |

## Riscos & Mitigacao

| Risco | Probabilidade | Impacto | Mitigacao |
|---|---|---|---|
| IA ignora restricoes de formato | Media | Alto | Reforcar restricoes no prompt + exemplos |
| Reel 30s fica longo demais | Media | Medio | Instrucao explicita de contagem de palavras |
| Carrossel com slides longos demais | Media | Medio | "MAX 30 PALAVRAS POR SLIDE" em caps no prompt |
| Formatos todos parecem iguais | Baixa | Alto | Estruturas .md bem diferenciadas |

## Regras de Comunicacao (Sadhana)

### SEMPRE
- Adaptar tom ao formato (story = casual, post = reflexivo)
- Manter tom Sadhana independente do formato
- CTA suave em todos os formatos
- Hashtags relevantes e nao genericas

### NUNCA
- CTA agressivo em reels ("link na bio AGORA")
- Carrossel com slide de "COMPRE AGORA"
- Story com countdown timer
- Post feed com excesso de emojis (max 3)

## Referencias

- Story 7.1 (Arquitetura) -- estrutura de prompts/formatos/
- Story 7.3 (CLI Basico) -- base do CLI
- Story 7.4 (Avatar) -- padrao de extensao do CLI
- Instagram best practices por formato

## Change Log

| Data | Mudanca | Autor |
|---|---|---|
| 2026-02-14 | Story criada | Morgan (PM) |
