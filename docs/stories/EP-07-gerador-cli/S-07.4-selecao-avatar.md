# Story 7.4: Selecao de Avatar no CLI

**Epic:** EP-07 - Gerador de Roteiros CLI
**Story ID:** 7.4
**Prioridade:** :dart: Alta
**Pontos:** 5
**Esforco:** 3-5 horas
**Status:** :white_circle: Draft
**Tipo:** :computer: Desenvolvimento & Feature

---

## User Story

Como **criadora de conteudo do Mente Leve**, quero **selecionar um avatar (Marina, Julia ou Camila) ao gerar um roteiro no CLI**, para que **o conteudo seja personalizado para a dor, tom e contexto da audiencia especifica que quero alcançar**.

## Objetivo

Adicionar ao CLI basico (Story 7.3) a funcionalidade de selecao de avatar. O usuario escolhe entre Marina (sobrecarregada), Julia (iniciante) ou Camila (inconsistente), e o roteiro gerado e personalizado para a dor, tom e gatilhos sensoriais daquele avatar. Inclui opcao "Geral" para conteudo sem personalizacao especifica.

## Contexto & Fundamentacao

- 3 avatares definidos com perfis completos na Story 7.2 (contextos de avatar)
- Marina (34, sobrecarregada): dor = "nao tenho tempo pra mim"
- Julia (28, iniciante insegura): dor = "nao sei se e pra mim"
- Camila (31, inconsistente): dor = "sempre comeco e nao mantenho"
- Personalizacao por avatar e o diferencial do gerador (vs prompt generico)
- Cada avatar tem tom, vocabulario e gatilhos sensoriais proprios
- Arquivos de contexto ja existem em `prompts/avatars/`

## Scope

### Incluido
- Selecao interativa de avatar no CLI (Inquirer list)
- Injecao do contexto de avatar no prompt enviado a IA
- 4 opcoes: Marina, Julia, Camila, Geral
- Descricao breve de cada avatar na selecao (para ajudar a escolher)
- Metadata de avatar no output e no arquivo salvo
- Teste manual de roteiro por avatar (tom diferente?)

### Excluido
- Criacao de novos avatares (apenas os 3 existentes)
- Selecao automatica de avatar (baseada em tema)
- Testes automatizados (Story 7.6)

### Dependencias
- Story 7.3 (CLI Basico) -- CLI funcional para extender
- Story 7.2 (Prompts) -- contextos de avatar em .md

### Entregaveis para downstream
- Story 7.5 (Formato) -- proxima extensao do CLI
- Story 7.6 (Testes) -- testar qualidade por avatar

## Tasks Breakdown

### Fase 1: Atualizar CLI (cli.js) (~1h)
- [ ] Adicionar pergunta de selecao de avatar no fluxo do CLI
  ```javascript
  {
    type: 'list',
    name: 'avatar',
    message: 'Para qual avatar?',
    choices: [
      {
        name: 'Marina (34, sobrecarregada - "nao tenho tempo pra mim")',
        value: 'marina'
      },
      {
        name: 'Julia (28, iniciante - "nao sei se e pra mim")',
        value: 'julia'
      },
      {
        name: 'Camila (31, inconsistente - "comeco e nao mantenho")',
        value: 'camila'
      },
      {
        name: 'Geral (sem personalizacao especifica)',
        value: 'geral'
      }
    ]
  }
  ```
- [ ] Posicionar pergunta apos tema (tema -> avatar -> salvar?)
- [ ] Exibir avatar selecionado no header do output

### Fase 2: Atualizar Prompt Builder (~1.5h)
- [ ] Implementar leitura do arquivo de avatar
  ```javascript
  export function buildPrompt(tema, avatar = 'geral') {
    const systemPrompt = readFileSync(
      join(__dirname, '../prompts/system-prompt.md'),
      'utf-8'
    );

    let avatarContext = '';
    if (avatar !== 'geral') {
      avatarContext = readFileSync(
        join(__dirname, `../prompts/avatars/${avatar}.md`),
        'utf-8'
      );
    }

    const userPromptTemplate = readFileSync(
      join(__dirname, '../prompts/user-prompt-template.md'),
      'utf-8'
    );

    // Injetar contexto de avatar no system prompt
    const fullSystemPrompt = systemPrompt
      + (avatarContext ? `\n\n## Avatar Alvo\n${avatarContext}` : '');

    const userPrompt = userPromptTemplate
      .replace('{{tema}}', tema)
      .replace('{{avatar_nome}}', getAvatarNome(avatar))
      .replace('{{avatar_contexto_resumido}}', getAvatarResumo(avatar));

    return { systemPrompt: fullSystemPrompt, userPrompt };
  }
  ```
- [ ] Criar funcao helper `getAvatarNome(avatar)`
- [ ] Criar funcao helper `getAvatarResumo(avatar)`
- [ ] Validar que arquivo de avatar existe antes de ler
- [ ] Tratar erro se avatar invalido

### Fase 3: Atualizar Output (~0.5h)
- [ ] Incluir avatar selecionado na metadata do terminal
  ```
  ──────────────────────────────────────────────────
    ROTEIRO SADHANA
    Tema: ansiedade
    Avatar: Marina (sobrecarregada, 34)
    Formato: Post Feed
  ──────────────────────────────────────────────────
  ```
- [ ] Incluir avatar no cabecalho do arquivo .md salvo
- [ ] Incluir avatar no nome do arquivo: `sadhana-marina-ansiedade-*.md`

### Fase 4: Teste Manual de Qualidade (~1h)
- [ ] Gerar 1 roteiro com tema "ansiedade" para CADA avatar
  - [ ] Marina: roteiro deve mencionar sobrecarga, filhos, trabalho
  - [ ] Julia: roteiro deve desmistificar, ser acolhedor com iniciante
  - [ ] Camila: roteiro deve normalizar inconsistencia, sem culpa
  - [ ] Geral: roteiro deve ser amplo, sem personalizacao especifica
- [ ] Comparar os 4 roteiros lado a lado
  - [ ] Tom diferente? Dor diferente? Gatilhos diferentes?
  - [ ] Se nao: ajustar contextos de avatar (mais explicitos)
- [ ] Documentar resultados do teste

### Fase 5: Ajustes Finos (~0.5h)
- [ ] Se necessario, reforcar instrucao no user prompt:
  ```
  IMPORTANTE: Este roteiro e ESPECIFICAMENTE para {{avatar_nome}}.
  Use a dor, o tom e os gatilhos sensoriais deste avatar.
  O roteiro deve ser DIFERENTE do que seria para outro avatar.
  ```
- [ ] Verificar que "Geral" nao ignora o system prompt base
- [ ] Limpar codigo, remover console.logs de debug

## Acceptance Criteria

### Must Have
- [ ] CLI oferece selecao de avatar (4 opcoes: Marina, Julia, Camila, Geral)
- [ ] Descricao breve de cada avatar visivel na selecao
- [ ] Contexto de avatar injetado no prompt enviado a IA
- [ ] Roteiro para Marina soa DIFERENTE de roteiro para Julia (teste manual)
- [ ] Avatar aparece na metadata do output (terminal e arquivo)
- [ ] Opcao "Geral" funciona sem erro

### Should Have
- [ ] Avatar no nome do arquivo salvo
- [ ] Teste comparativo documentado (mesmo tema, 3 avatares, resultados diferentes)
- [ ] Mensagem de erro se arquivo de avatar nao encontrado

### Nice to Have
- [ ] Sugestao de avatar baseada no tema
- [ ] Preview da dor do avatar antes de confirmar selecao
- [ ] Historico de avatares mais usados

## Entregaveis

| Entregavel | Localizacao | Conteudo | Usado Por |
|---|---|---|---|
| CLI atualizado | `sadhana-cli/src/cli.js` | Selecao de avatar | Equipe |
| Prompt Builder atualizado | `sadhana-cli/src/prompt-builder.js` | Injecao de avatar | AI Service |
| Teste comparativo | `docs/cli/teste-avatares.md` | 4 roteiros lado a lado | QA, Gaby |

## Metricas de Sucesso

| Metrica | Meta | Como Medir |
|---|---|---|
| Personalizacao perceptivel | > 70% identifica avatar correto em teste cego | Teste humano |
| Diferenca de tom entre avatares | Tom visivelmente diferente | Comparacao lado a lado |
| Tempo adicional de UX (selecao) | < 5 segundos | Cronometro |
| Erros na selecao de avatar | 0 | Teste manual |

## Riscos & Mitigacao

| Risco | Probabilidade | Impacto | Mitigacao |
|---|---|---|---|
| IA ignora contexto de avatar | Media | Alto | Reforcar instrucao no user prompt + few-shot |
| Avatares parecem estereotipados | Media | Medio | Contextos com nuances, validar com Gaby |
| Roteiros todos iguais apesar do avatar | Media | Alto | Teste comparativo obrigatorio |
| Arquivo de avatar corrompido/ausente | Baixa | Medio | Fallback para "Geral" com aviso |

## Regras de Comunicacao (Sadhana)

### SEMPRE
- Descricoes de avatar com empatia (nao rotulo clinico)
- Dor do avatar como espelho (nao como problema a resolver)
- Tom adaptado mas sempre dentro do universo Sadhana
- Respeitar nuances: Marina nao e "so" mae, Julia nao e "so" insegura

### NUNCA
- Caricaturar avatares (reduzir a um estereotipo)
- Usar linguagem pejorativa na descricao do avatar
- Gerar conteudo que culpe o avatar pela dor
- Ignorar o contexto de avatar no output

## Referencias

- Story 7.2 (Prompts) -- contextos de avatar completos
- Story 7.3 (CLI Basico) -- base a ser extendida
- Story 7.1 (Arquitetura) -- estrutura de prompts/avatars/
- SADHANA-STRATEGIC-ANALYSIS-INTEGRATED.md -- perfis originais

## Change Log

| Data | Mudanca | Autor |
|---|---|---|
| 2026-02-14 | Story criada | Morgan (PM) |
